(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))y(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const _ of c.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&y(_)}).observe(document,{childList:!0,subtree:!0});function A(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function y(i){if(i.ep)return;i.ep=!0;const c=A(i);fetch(i.href,c)}})();function te(){sap.ui.require(["sap/m/App","sap/m/Page","sap/m/Input","sap/m/Button","sap/m/Title","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/Text","sap/ui/model/json/JSONModel","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/ui/model/Sorter","sap/m/ViewSettingsDialog","sap/ui/model/Filter","sap/m/ViewSettingsFilterItem","sap/m/ViewSettingsItem","sap/m/VBox","sap/m/FormattedText","sap/m/ObjectNumber","sap/f/Avatar","sap/m/ObjectIdentifier","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/TreeBinding","sap/ui/unified/Currency"],function(j,h,A,y,i,c,_,ne,t,N,oe,se,ae,re,ie,le,ce,pe,F,de,K,me,k,l,ue,fe){const B=new N({root:[],SourceCredit:"<p>Source des données: <cite>Caisse nationale de l'assurance maladie</cite></p>"}),T=new K({src:"https://nicolasjak.github.io/cassylprod/CassylMama.jpg",displaySize:"L",showBorder:!1,visible:!1,press:function(){window.location.href="https://cassylmama.com"}}),w=new A({placeholder:"Code postal",width:"100px"});let u;u=new sap.m.Title({text:"Sages-femmes",id:"professionnelsTitle"});const E=new sap.m.VBox({items:[new F({htmlText:B.getData().SourceCredit})]});function J(o){const a=[];let n=null;for(const e of o){const s=[e.nom,e.commune,e.type_dacte_realise,e.nom_acte||""].join("|"),r=n?[n.nom,n.commune,n.type_dacte_realise,n.nom_acte||""].join("|"):null;s!==r&&a.push(e),n=e}return a}function q(o){const a=new Map;o.forEach(e=>{const s=[e.nom||"",e.civilite||"",e.column_13||"",e.adresse||"",e.epci_name||"",e.commune||"",e.column_14||""].join("|");a.has(s)||a.set(s,{nom:e.nom,civilite:e.civilite,column_13:e.column_13,adresse:e.adresse,column_10:e.column_10,epci_name:e.epci_name,commune:e.commune,column_14:e.column_14,children:[]});const r={...e};delete r.nom,a.get(s).children.push(r)});const n=Array.from(a.values());return n.forEach(e=>{const s=new Map;e.children.forEach(r=>{const p=r.type_dacte_realise||"Autre";if(r.nom_acte&&r.libelle){const d=r.nom_acte||"";s.has(p)||s.set(p,{nom:p,children:new Map});const b=s.get(p);b.children.has(d)||b.children.set(d,{nom:d,children:[]}),b.children.get(d).children.push(r)}else s.has(p)||s.set(p,{nom:p,children:[]})}),e.children=Array.from(s.values()).map(r=>{if(r.children instanceof Map){const p=Array.from(r.children.values()).map(d=>({nom:d.nom,children:z(Array.isArray(d.children)?d.children:[])}));return{nom:r.nom,children:p}}else return r})}),n}function z(o){if(!Array.isArray(o))return[];const a=new Set;return o.filter(n=>{const e=[n.type_dacte_realise||"",n.nom_acte||"",n.libelle||""].join("|");return a.has(e)?!1:(a.add(e),!0)})}function $(){const o=m.getBinding("rows");let a=0;if(o&&(a=o.getContexts(0,o.getLength()).filter(e=>{const s=e.getPath();return/^\/root\/\d+$/.test(s)}).length),u){const n=u.getText().replace(/\(\d+\)$/,"").trim();a!==0&&u.setText(`${n} (${a})`)}}const H=new y({text:"Rechercher",width:"100px",press:async function(){await D()}});async function D(){g.setVisible(!0);const o=w.getValue();if(o)try{var a=function(S){switch(S){case"1":return"Information";case"2a":return"Information";case"2b":return"Information";case"3":return"Information";default:return"Information"}};g.setVisible(!0);const n=R.getSelectedIndex()===0?"Sage-femme":"Gynécologue obstétricien",s=await(await fetch(`https://geo.api.gouv.fr/communes?codePostal=${encodeURIComponent(o)}&fields=codeEpci,codeDepartement&format=json`)).json();if(!s.length)throw new Error("Code postal non trouvé.");const r=s[0].code,p=s[0].codeEpci,d=s[0].codeDepartement;async function b(S,Z,ee){const M=encodeURIComponent(n),v=100,P=[`https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/medecins/records?where=code_insee=${encodeURIComponent(ee)}&refine=libelle_profession:"${M}"`,`https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/medecins/records?where=epci_code=${encodeURIComponent(S)}&refine=dep_code:${encodeURIComponent(Z)}&refine=libelle_profession:"${M}"`,`https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/medecins/records?where=epci_code=${encodeURIComponent(S)}&refine=libelle_profession:"${M}"`];for(let I=0;I<P.length;I++){const V=P[I],x=await(await fetch(`${V}&limit=${v}&offset=0`)).json();if(x.results&&x.total_count){const L=x.total_count;if(L<50&&I<P.length-1)continue;let C=[...x.results],O=v;for(;C.length<L;){const U=await(await fetch(`${V}&limit=${v}&offset=${O}`)).json();if(U.results&&U.results.length>0)C=C.concat(U.results),O+=v;else break}return C}}return[]}const W=await b(p,d,r),X=J(W),Y=q(X);B.setData({root:Y}),$(),g.setVisible(!1)}catch(n){g.setVisible(!1),alert("Erreur lors de la recherche."),console.error(n)}}const R=new sap.m.RadioButtonGroup("radioGroup",{columns:2,selectedIndex:0,buttons:[new sap.m.RadioButton("radio1",{text:"Sage-femme"}),new sap.m.RadioButton("radio2",{text:"Gynécologue"})],select:function(o){const a=o.getParameter("selectedIndex");u&&u.setText(a===0?"Sages-femmes":"Gynécologues obstétricien")}}),m=new k("professionnelsTreeTable",{rows:{path:"/root",parameters:{arrayNames:["children"]}},visibleRowCount:20,selectionMode:"None",columns:[new l({width:"22em",label:new t({text:"Nom / Type Acte / Acte"}),template:new t({text:"{nom}"}),filterProperty:"nom"}),new l({width:"8em",label:new t({text:"Civilite"}),template:new t({text:"{civilite}"}),filterProperty:"civilite"}),new l({width:"10em",label:new t({text:"Nature d'exercice"}),template:new t({text:"{column_13}"}),filterProperty:"column_13"}),new l({width:"20em",label:new t({text:"Adresse"}),template:new t({text:"{adresse}"}),filterProperty:"adresse"}),new l({width:"10em",label:new t({text:"Commune"}),template:new t({text:"{commune}"}),filterProperty:"commune"}),new l({width:"7em",label:new t({text:"Téléphone"}),template:new t({text:"{column_10}"})}),new l({width:"12em",label:new t({text:"Convention et CAS"}),template:new t({text:"{column_14}"}),filterProperty:"column_14"}),new l({visible:!1,width:"8em",label:new t({text:"Type Acte"}),template:new t({text:"{type_dacte_realise}"}),filterProperty:"type_dacte_realise"}),new l({visible:!1,label:new t({text:"Acte"}),template:new t({text:"{nom_acte}"}),filterProperty:"nom_acte"}),new l({label:new t({text:"Libelle"}),template:new t({text:"{libelle}"}),filterProperty:"libelle"}),new l({width:"4em",label:new t({text:"Tarif 1"}),template:new t({text:"{tarif_1}"}),filterProperty:"tarif_1",visible:!1}),new l({width:"4em",label:new t({text:"Tarif 2"}),template:new t({text:"{tarif_2}"}),filterProperty:"tarif_2",visible:!1}),new l({width:"6em",label:new t({text:"Tarif base remb. secu. sociale"}),template:new t({text:"{tarif_base_de_remboursement_securite_sociale}"}),filterProperty:"tarif_base_de_remboursement_securite_sociale",visible:!1})]}),g=new sap.m.BusyIndicator({visible:!1});var G=new sap.m.OverflowToolbar({style:"Clear",content:[u,new sap.m.ToolbarSpacer,g,new sap.m.ToolbarSpacer,new sap.m.Button({text:"Développer le premier niveau",press:function(){m.expandToLevel(1)}}),new sap.m.Button({text:"Réduire tout",press:function(){m.collapseAll()}}),new sap.m.Button({text:"Développer tout",press:function(){m.expandToLevel(3)}})]});m.addExtension(G),m.attachEvent("rowsUpdated",function(){$()}),m.setModel(B),w.attachBrowserEvent("keydown",function(o){o.key==="Enter"&&D()}),T.addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd sapUiMediumMarginTop"),w.addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd"),R.addStyleClass("sapUiSmallMarginBegin"),E.addStyleClass("sapUiSmallMarginBegin"),m.expandToLevel(0);const Q=new h({showHeader:!1,backgroundDesign:"Transparent",titleAlignment:"Center",content:[new sap.m.VBox({items:[R,new sap.m.HBox({items:[T,w,H],alignItems:"Center",justifyContent:"Start"}),E,m],width:"100%"})]});new j({autoFocus:!1,pages:[Q]}).placeAt("content"),setTimeout(function(){var o=w.getDomRef();o?w.focus():console.warn("Input DOM not ready.")},0)})}window.onUI5Init=te;const f=document.createElement("script");f.id="sap-ui-bootstrap";f.src="https://sdk.openui5.org/resources/sap-ui-core.js";f.setAttribute("data-sap-ui-libs","sap.m");f.setAttribute("data-sap-ui-theme","sap_horizon");f.setAttribute("data-sap-ui-async","true");f.setAttribute("data-sap-ui-onInit","onUI5Init");document.head.appendChild(f);
