(function(){const S=document.createElement("link").relList;if(S&&S.supports&&S.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))I(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const C of c.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&I(C)}).observe(document,{childList:!0,subtree:!0});function R(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function I(a){if(a.ep)return;a.ep=!0;const c=R(a);fetch(a.href,c)}})();function ne(){sap.ui.require(["sap/m/App","sap/m/Page","sap/m/Input","sap/m/Button","sap/m/Title","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/Text","sap/ui/model/json/JSONModel","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/ui/model/Sorter","sap/m/ViewSettingsDialog","sap/ui/model/Filter","sap/m/ViewSettingsFilterItem","sap/m/ViewSettingsItem","sap/m/VBox","sap/m/FormattedText","sap/m/ObjectNumber","sap/f/Avatar","sap/m/ObjectIdentifier","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/TreeBinding","sap/ui/unified/Currency"],function(E,S,R,I,a,c,C,oe,t,F,se,ae,ie,re,le,ce,pe,me,J,de,K,ue,k,l,fe,we){const M=new F({root:[],SourceCredit:"<p>Source des données: <cite>Caisse nationale de l'assurance maladie</cite></p>"}),T=new K({src:"https://nicolasjak.github.io/cassylprod/CassylMama.jpg",displaySize:"L",showBorder:!1,visible:!1,press:function(){window.location.href="https://cassylmama.com"}}),y=new R({placeholder:"Code postal",width:"100px"});let f;f=new sap.m.Title({text:"Sages-femmes",id:"professionnelsTitle"});const U=new sap.m.VBox({items:[new J({htmlText:M.getData().SourceCredit})]});function q(o){const i=[];let s=null;for(const e of o){const r=[e.nom,e.commune,e.type_dacte_realise,e.nom_acte||""].join("|"),n=s?[s.nom,s.commune,s.type_dacte_realise,s.nom_acte||""].join("|"):null;r!==n&&i.push(e),s=e}return i}function z(o){const i=new Map;o.forEach(e=>{const r=[e.nom||"",e.civilite||"",e.column_13||"",e.adresse||"",e.epci_name||"",e.commune||"",e.column_14||""].join("|");i.has(r)||i.set(r,{nom:e.nom,civilite:e.civilite,column_13:e.column_13,adresse:e.adresse,column_10:e.column_10,epci_name:e.epci_name,commune:e.commune,column_14:e.column_14,children:[]});const n={...e};delete n.nom,i.get(r).children.push(n)});const s=Array.from(i.values());return s.forEach(e=>{const r=new Map;e.children.forEach(n=>{const p=n.type_dacte_realise||"Autre";if(n.nom_acte&&n.libelle){const u=n.nom_acte||"";r.has(p)||r.set(p,{nom:p,children:new Map});const _=r.get(p);_.children.has(u)||_.children.set(u,{nom:u,children:[]}),_.children.get(u).children.push(n)}else r.has(p)||r.set(p,{nom:p,children:[]})}),e.children=Array.from(r.values()).map(n=>{if(n.children instanceof Map){const p=Array.from(n.children.values()).map(u=>({nom:u.nom,children:H(Array.isArray(u.children)?u.children:[])}));return{nom:n.nom,children:p}}else return n})}),s}function H(o){if(!Array.isArray(o))return[];const i=new Set;return o.filter(s=>{const e=[s.type_dacte_realise||"",s.nom_acte||"",s.libelle||""].join("|");return i.has(e)?!1:(i.add(e),!0)})}function P(){const o=d.getBinding("rows");let i=0;if(o&&(i=o.getContexts(0,o.getLength()).filter(e=>{const r=e.getPath();return/^\/root\/\d+$/.test(r)}).length),f){const s=f.getText().replace(/\(\d+\)$/,"").trim();f.setText(`${s} (${i})`)}}const G=new I({text:"Rechercher",width:"100px",press:async function(){await $()}});async function $(){var s;v.setVisible(!0);const o=y.getValue();if(o)try{var i=function(m){switch(m){case"1":return"Information";case"2a":return"Information";case"2b":return"Information";case"3":return"Information";default:return"Information"}};v.setVisible(!0);const e=j.getSelectedIndex()===0?"Sage-femme":"Gynécologue obstétricien",n=await(await fetch(`https://geo.api.gouv.fr/communes?codePostal=${encodeURIComponent(o)}&fields=codeEpci,codeDepartement&format=json`)).json();if(!n.length)throw new Error("Code postal non trouvé.");const p=n[0].code,u=n[0].codeDepartement,_=[...new Set(n.map(m=>m.codeEpci).filter(Boolean))],he=[],ge=[...new Set(_)];async function X(m){var O;const A=encodeURIComponent(e),h=100,x=`https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/medecins/records?where=epci_code=%22${encodeURIComponent(m)}%22&refine=libelle_profession:"${A}"`,g=await(await fetch(`${x}&limit=${h}&offset=0`)).json();if(!g.results||!g.total_count)return[];const te=g.total_count;let B=[...g.results],V=h;for(;B.length<te;){const N=await(await fetch(`${x}&limit=${h}&offset=${V}`)).json();if(!((O=N.results)!=null&&O.length))break;B=B.concat(N.results),V+=h}return B}let w=[];const D=n[0].nom,L=D.charAt(0).toUpperCase()+D.slice(1).toLowerCase();if(["Paris","Lyon","Marseille"].includes(L)){const m=`https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/medecins/records?where=commune=%22${encodeURIComponent(L)}%22&refine=libelle_profession:"${encodeURIComponent(e)}"`,h=await(await fetch(`${m}&limit=100&offset=0`)).json();w=h.results||[];let x=100;for(;w.length<h.total_count;){const g=await(await fetch(`${m}&limit=100&offset=${x}`)).json();if(!((s=g.results)!=null&&s.length))break;w=w.concat(g.results),x+=100}}else for(const m of _){const A=await X(m);w=w.concat(A)}const Y=q(w),Z=z(Y);M.setData({root:Z}),P(),v.setVisible(!1)}catch(e){P(),v.setVisible(!1),alert("Erreur lors de la recherche."),console.error(e)}}const j=new sap.m.RadioButtonGroup("radioGroup",{columns:2,selectedIndex:0,buttons:[new sap.m.RadioButton("radio1",{text:"Sage-femme"}),new sap.m.RadioButton("radio2",{text:"Gynécologue"})],select:function(o){const i=o.getParameter("selectedIndex");f&&f.setText(i===0?"Sages-femmes":"Gynécologues obstétricien")}}),d=new k("professionnelsTreeTable",{rows:{path:"/root",parameters:{arrayNames:["children"]}},visibleRowCount:20,selectionMode:"None",columns:[new l({width:"22em",label:new t({text:"Nom / Type Acte / Acte"}),template:new t({text:"{nom}"}),filterProperty:"nom"}),new l({width:"8em",label:new t({text:"Civilite"}),template:new t({text:"{civilite}"}),filterProperty:"civilite"}),new l({width:"10em",label:new t({text:"Nature d'exercice"}),template:new t({text:"{column_13}"}),filterProperty:"column_13"}),new l({width:"20em",label:new t({text:"Adresse"}),template:new t({text:"{adresse}"}),filterProperty:"adresse"}),new l({width:"10em",label:new t({text:"Commune"}),template:new t({text:"{commune}"}),filterProperty:"commune"}),new l({width:"7em",label:new t({text:"Téléphone"}),template:new t({text:"{column_10}"})}),new l({width:"12em",label:new t({text:"Convention et CAS"}),template:new t({text:"{column_14}"}),filterProperty:"column_14"}),new l({visible:!1,width:"8em",label:new t({text:"Type Acte"}),template:new t({text:"{type_dacte_realise}"}),filterProperty:"type_dacte_realise"}),new l({visible:!1,label:new t({text:"Acte"}),template:new t({text:"{nom_acte}"}),filterProperty:"nom_acte"}),new l({label:new t({text:"Libelle"}),template:new t({text:"{libelle}"}),filterProperty:"libelle"}),new l({width:"4em",label:new t({text:"Tarif 1"}),template:new t({text:"{tarif_1}"}),filterProperty:"tarif_1",visible:!1}),new l({width:"4em",label:new t({text:"Tarif 2"}),template:new t({text:"{tarif_2}"}),filterProperty:"tarif_2",visible:!1}),new l({width:"6em",label:new t({text:"Tarif base remb. secu. sociale"}),template:new t({text:"{tarif_base_de_remboursement_securite_sociale}"}),filterProperty:"tarif_base_de_remboursement_securite_sociale",visible:!1})]}),v=new sap.m.BusyIndicator({visible:!1});var Q=new sap.m.OverflowToolbar({style:"Clear",content:[f,new sap.m.ToolbarSpacer,v,new sap.m.ToolbarSpacer,new sap.m.Button({text:"Développer le premier niveau",press:function(){d.expandToLevel(1)}}),new sap.m.Button({text:"Réduire tout",press:function(){d.collapseAll()}}),new sap.m.Button({text:"Développer tout",press:function(){d.expandToLevel(3)}})]});d.addExtension(Q),d.attachEvent("rowsUpdated",function(){P()}),d.setModel(M),y.attachBrowserEvent("keydown",function(o){o.key==="Enter"&&$()}),T.addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd sapUiMediumMarginTop"),y.addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd"),j.addStyleClass("sapUiSmallMarginBegin"),U.addStyleClass("sapUiSmallMarginBegin"),d.expandToLevel(0);const W=new S({showHeader:!1,backgroundDesign:"Transparent",titleAlignment:"Center",content:[new sap.m.VBox({items:[j,new sap.m.HBox({items:[T,y,G],alignItems:"Center",justifyContent:"Start"}),U,d],width:"100%"})]});new E({autoFocus:!1,pages:[W]}).placeAt("content"),setTimeout(function(){var o=y.getDomRef();o?y.focus():console.warn("Input DOM not ready.")},0)})}window.onUI5Init=ne;const b=document.createElement("script");b.id="sap-ui-bootstrap";b.src="https://sdk.openui5.org/resources/sap-ui-core.js";b.setAttribute("data-sap-ui-libs","sap.m");b.setAttribute("data-sap-ui-theme","sap_horizon");b.setAttribute("data-sap-ui-async","true");b.setAttribute("data-sap-ui-onInit","onUI5Init");document.head.appendChild(b);
