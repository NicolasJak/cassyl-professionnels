(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))y(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const _ of c.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&y(_)}).observe(document,{childList:!0,subtree:!0});function B(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function y(s){if(s.ep)return;s.ep=!0;const c=B(s);fetch(s.href,c)}})();function Z(){sap.ui.require(["sap/m/App","sap/m/Page","sap/m/Input","sap/m/Button","sap/m/Title","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/Text","sap/ui/model/json/JSONModel","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/ui/model/Sorter","sap/m/ViewSettingsDialog","sap/ui/model/Filter","sap/m/ViewSettingsFilterItem","sap/m/ViewSettingsItem","sap/m/VBox","sap/m/FormattedText","sap/m/ObjectNumber","sap/f/Avatar","sap/m/ObjectIdentifier","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/TreeBinding","sap/ui/unified/Currency"],function(E,g,B,y,s,c,_,ee,t,$,te,ne,oe,ae,se,re,ie,le,N,ce,F,pe,K,l,de,me){const C=new $({root:[],SourceCredit:"<p>Source des données: <cite>Caisse nationale de l'assurance maladie</cite></p>"}),j=new F({src:"https://nicolasjak.github.io/cassylprod/CassylMama.jpg",displaySize:"L",showBorder:!1,visible:!1,press:function(){window.location.href="https://cassylmama.com"}}),h=new B({placeholder:"Code postal",width:"100px"});let u;u=new sap.m.Title({text:"Sages-femmes",id:"professionnelsTitle"});const T=new sap.m.VBox({items:[new N({htmlText:C.getData().SourceCredit})]});function k(o){const r=[];let n=null;for(const e of o){const a=[e.nom,e.commune,e.type_dacte_realise,e.nom_acte||""].join("|"),i=n?[n.nom,n.commune,n.type_dacte_realise,n.nom_acte||""].join("|"):null;a!==i&&r.push(e),n=e}return r}function q(o){const r=new Map;o.forEach(e=>{const a=[e.nom||"",e.civilite||"",e.column_13||"",e.adresse||"",e.epci_name||"",e.commune||"",e.column_14||""].join("|");r.has(a)||r.set(a,{nom:e.nom,civilite:e.civilite,column_13:e.column_13,adresse:e.adresse,column_10:e.column_10,epci_name:e.epci_name,commune:e.commune,column_14:e.column_14,children:[]});const i={...e};delete i.nom,r.get(a).children.push(i)});const n=Array.from(r.values());return n.forEach(e=>{const a=new Map;e.children.forEach(i=>{const d=i.type_dacte_realise||"Autre";if(i.nom_acte&&i.libelle){const p=i.nom_acte||"";a.has(d)||a.set(d,{nom:d,children:new Map});const S=a.get(d);S.children.has(p)||S.children.set(p,{nom:p,children:[]}),S.children.get(p).children.push(i)}else a.has(d)||a.set(d,{nom:d,children:[]})}),e.children=Array.from(a.values()).map(i=>{if(i.children instanceof Map){const d=Array.from(i.children.values()).map(p=>({nom:p.nom,children:J(Array.isArray(p.children)?p.children:[])}));return{nom:i.nom,children:d}}else return i})}),n}function J(o){if(!Array.isArray(o))return[];const r=new Set;return o.filter(n=>{const e=[n.type_dacte_realise||"",n.nom_acte||"",n.libelle||""].join("|");return r.has(e)?!1:(r.add(e),!0)})}function A(){const o=m.getBinding("rows");let r=0;if(o&&(r=o.getContexts(0,o.getLength()).filter(e=>{const a=e.getPath();return/^\/root\/\d+$/.test(a)}).length),u){const n=u.getText().replace(/\(\d+\)$/,"").trim();u.setText(`${n} (${r})`)}}const z=new y({text:"Rechercher",width:"100px",press:async function(){await D()}});async function D(){b.setVisible(!0);const o=h.getValue();if(o)try{var r=function(f){switch(f){case"1":return"Information";case"2a":return"Information";case"2b":return"Information";case"3":return"Information";default:return"Information"}};b.setVisible(!0);const n=M.getSelectedIndex()===0?"Sage-femme":"Gynécologue obstétricien",a=await(await fetch(`https://geo.api.gouv.fr/communes?codePostal=${encodeURIComponent(o)}&fields=codeEpci,codeDepartement&format=json`)).json();if(!a.length)throw new Error("Code postal non trouvé.");const i=a[0].code,d=a[0].codeDepartement,p=[...new Set(a.map(f=>f.codeEpci).filter(Boolean))],S=[],ue=[...new Set(p)];async function Q(f){var L;const R=encodeURIComponent(n),v=100,V=`https://public.opendatasoft.com/api/explore/v2.1/catalog/datasets/medecins/records?where=epci_code=%22${encodeURIComponent(f)}%22&refine=libelle_profession:"${R}"`,x=await(await fetch(`${V}&limit=${v}&offset=0`)).json();if(!x.results||!x.total_count)return[];const Y=x.total_count;let I=[...x.results],U=v;for(;I.length<Y;){const O=await(await fetch(`${V}&limit=${v}&offset=${U}`)).json();if(!((L=O.results)!=null&&L.length))break;I=I.concat(O.results),U+=v}return I}let P=[];for(const f of p){const R=await Q(f);P=P.concat(R)}const W=k(P),X=q(W);C.setData({root:X}),A(),b.setVisible(!1)}catch(n){A(),b.setVisible(!1),alert("Erreur lors de la recherche."),console.error(n)}}const M=new sap.m.RadioButtonGroup("radioGroup",{columns:2,selectedIndex:0,buttons:[new sap.m.RadioButton("radio1",{text:"Sage-femme"}),new sap.m.RadioButton("radio2",{text:"Gynécologue"})],select:function(o){const r=o.getParameter("selectedIndex");u&&u.setText(r===0?"Sages-femmes":"Gynécologues obstétricien")}}),m=new K("professionnelsTreeTable",{rows:{path:"/root",parameters:{arrayNames:["children"]}},visibleRowCount:20,selectionMode:"None",columns:[new l({width:"22em",label:new t({text:"Nom / Type Acte / Acte"}),template:new t({text:"{nom}"}),filterProperty:"nom"}),new l({width:"8em",label:new t({text:"Civilite"}),template:new t({text:"{civilite}"}),filterProperty:"civilite"}),new l({width:"10em",label:new t({text:"Nature d'exercice"}),template:new t({text:"{column_13}"}),filterProperty:"column_13"}),new l({width:"20em",label:new t({text:"Adresse"}),template:new t({text:"{adresse}"}),filterProperty:"adresse"}),new l({width:"10em",label:new t({text:"Commune"}),template:new t({text:"{commune}"}),filterProperty:"commune"}),new l({width:"7em",label:new t({text:"Téléphone"}),template:new t({text:"{column_10}"})}),new l({width:"12em",label:new t({text:"Convention et CAS"}),template:new t({text:"{column_14}"}),filterProperty:"column_14"}),new l({visible:!1,width:"8em",label:new t({text:"Type Acte"}),template:new t({text:"{type_dacte_realise}"}),filterProperty:"type_dacte_realise"}),new l({visible:!1,label:new t({text:"Acte"}),template:new t({text:"{nom_acte}"}),filterProperty:"nom_acte"}),new l({label:new t({text:"Libelle"}),template:new t({text:"{libelle}"}),filterProperty:"libelle"}),new l({width:"4em",label:new t({text:"Tarif 1"}),template:new t({text:"{tarif_1}"}),filterProperty:"tarif_1",visible:!1}),new l({width:"4em",label:new t({text:"Tarif 2"}),template:new t({text:"{tarif_2}"}),filterProperty:"tarif_2",visible:!1}),new l({width:"6em",label:new t({text:"Tarif base remb. secu. sociale"}),template:new t({text:"{tarif_base_de_remboursement_securite_sociale}"}),filterProperty:"tarif_base_de_remboursement_securite_sociale",visible:!1})]}),b=new sap.m.BusyIndicator({visible:!1});var H=new sap.m.OverflowToolbar({style:"Clear",content:[u,new sap.m.ToolbarSpacer,b,new sap.m.ToolbarSpacer,new sap.m.Button({text:"Développer le premier niveau",press:function(){m.expandToLevel(1)}}),new sap.m.Button({text:"Réduire tout",press:function(){m.collapseAll()}}),new sap.m.Button({text:"Développer tout",press:function(){m.expandToLevel(3)}})]});m.addExtension(H),m.attachEvent("rowsUpdated",function(){A()}),m.setModel(C),h.attachBrowserEvent("keydown",function(o){o.key==="Enter"&&D()}),j.addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd sapUiMediumMarginTop"),h.addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd"),M.addStyleClass("sapUiSmallMarginBegin"),T.addStyleClass("sapUiSmallMarginBegin"),m.expandToLevel(0);const G=new g({showHeader:!1,backgroundDesign:"Transparent",titleAlignment:"Center",content:[new sap.m.VBox({items:[M,new sap.m.HBox({items:[j,h,z],alignItems:"Center",justifyContent:"Start"}),T,m],width:"100%"})]});new E({autoFocus:!1,pages:[G]}).placeAt("content"),setTimeout(function(){var o=h.getDomRef();o?h.focus():console.warn("Input DOM not ready.")},0)})}window.onUI5Init=Z;const w=document.createElement("script");w.id="sap-ui-bootstrap";w.src="https://sdk.openui5.org/resources/sap-ui-core.js";w.setAttribute("data-sap-ui-libs","sap.m");w.setAttribute("data-sap-ui-theme","sap_horizon");w.setAttribute("data-sap-ui-async","true");w.setAttribute("data-sap-ui-onInit","onUI5Init");document.head.appendChild(w);
